import{S as V}from"./sortablejs-6811de32.js";import{ah as S,a1 as F,H as $,ag as g,n as b}from"./@vue-0daf1ea7.js";function u(t){t.parentElement!==null&&t.parentElement.removeChild(t)}function p(t,e,n){const o=n===0?t.children[0]:t.children[n-1].nextSibling;t.insertBefore(e,o)}function A(){return typeof window<"u"?window.console:global.console}const U=A();function O(t){const e=Object.create(null);return function(o){return e[o]||(e[o]=t(o))}}const k=/-(\w)/g,v=O(t=>t.replace(k,(e,n)=>n.toUpperCase())),y=["Start","Add","Remove","Update","End"],C=["Choose","Unchoose","Sort","Filter","Clone"],_=["Move"],R=[_,y,C].flatMap(t=>t).map(t=>`on${t}`),h={manage:_,manageAndEmit:y,emit:C};function T(t){return R.indexOf(t)!==-1}const j=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function M(t){return j.includes(t)}function q(t){return["transition-group","TransitionGroup"].includes(t)}function I(t){return["id","class","role","style"].includes(t)||t.startsWith("data-")||t.startsWith("aria-")||t.startsWith("on")}function E(t){return t.reduce((e,[n,o])=>(e[n]=o,e),{})}function N({$attrs:t,componentData:e={}}){return{...E(Object.entries(t).filter(([o,r])=>I(o))),...e}}function P({$attrs:t,callBackBuilder:e}){const n=E(D(t));Object.entries(e).forEach(([r,i])=>{h[r].forEach(s=>{n[`on${s}`]=i(s)})});const o=`[data-draggable]${n.draggable||""}`;return{...n,draggable:o}}function D(t){return Object.entries(t).filter(([e,n])=>!I(e)).map(([e,n])=>[v(e),n]).filter(([e,n])=>!T(e))}const f=({el:t})=>t,H=(t,e)=>t.__draggable_context=e,x=t=>t.__draggable_context;class B{constructor({nodes:{header:e,default:n,footer:o},root:r,realList:i}){this.defaultNodes=n,this.children=[...e,...n,...o],this.externalComponent=r.externalComponent,this.rootTransition=r.transition,this.tag=r.tag,this.realList=i}get _isRootComponent(){return this.externalComponent||this.rootTransition}render(e,n){const{tag:o,children:r,_isRootComponent:i}=this;return e(o,n,i?{default:()=>r}:r)}updated(){const{defaultNodes:e,realList:n}=this;e.forEach((o,r)=>{H(f(o),{element:n[r],index:r})})}getUnderlyingVm(e){return x(e)}getVmIndexFromDomIndex(e,n){const{defaultNodes:o}=this,{length:r}=o,i=n.children,s=i.item(e);if(s===null)return r;const a=x(s);if(a)return a.index;if(r===0)return 0;const l=f(o[0]),d=[...i].findIndex(c=>c===l);return e<d?0:r}}function K(t,e){const n=t[e];return n?n():[]}function W({$slots:t,realList:e,getKey:n}){const o=e||[],[r,i]=["header","footer"].map(l=>K(t,l)),{item:s}=t;if(!s)throw new Error("draggable element must have an item slot");const a=o.flatMap((l,d)=>s({element:l,index:d}).map(c=>(c.key=n(l),c.props={...c.props||{},"data-draggable":!0},c)));if(a.length!==o.length)throw new Error("Item slot must have only one child");return{header:r,footer:i,default:a}}function z(t){const e=q(t),n=!M(t)&&!e;return{transition:e,externalComponent:n,tag:n?S(t):e?F:t}}function G({$slots:t,tag:e,realList:n,getKey:o}){const r=W({$slots:t,realList:n,getKey:o}),i=z(e);return new B({nodes:r,root:i,realList:n})}function w(t,e){b(()=>this.$emit(t.toLowerCase(),e))}function L(t){return(e,n)=>{if(this.realList!==null)return this[`onDrag${t}`](e,n)}}function J(t){const e=L.call(this,t);return(n,o)=>{e.call(this,n,o),w.call(this,t,n)}}let m=null;const Q={list:{type:Array,required:!1,default:null},modelValue:{type:Array,required:!1,default:null},itemKey:{type:[String,Function],required:!0},clone:{type:Function,default:t=>t},tag:{type:String,default:"div"},move:{type:Function,default:null},componentData:{type:Object,required:!1,default:null}},X=["update:modelValue","change",...[...h.manageAndEmit,...h.emit].map(t=>t.toLowerCase())],tt=$({name:"draggable",inheritAttrs:!1,props:Q,emits:X,data(){return{error:!1}},render(){try{this.error=!1;const{$slots:t,$attrs:e,tag:n,componentData:o,realList:r,getKey:i}=this,s=G({$slots:t,tag:n,realList:r,getKey:i});this.componentStructure=s;const a=N({$attrs:e,componentData:o});return s.render(g,a)}catch(t){return this.error=!0,g("pre",{style:{color:"red"}},t.stack)}},created(){this.list!==null&&this.modelValue!==null&&U.error("modelValue and list props are mutually exclusive! Please set one or another.")},mounted(){if(this.error)return;const{$attrs:t,$el:e,componentStructure:n}=this;n.updated();const o=P({$attrs:t,callBackBuilder:{manageAndEmit:i=>J.call(this,i),emit:i=>w.bind(this,i),manage:i=>L.call(this,i)}}),r=e.nodeType===1?e:e.parentElement;this._sortable=new V(r,o),this.targetDomElement=r,r.__draggable_component__=this},updated(){this.componentStructure.updated()},beforeUnmount(){this._sortable!==void 0&&this._sortable.destroy()},computed:{realList(){const{list:t}=this;return t||this.modelValue},getKey(){const{itemKey:t}=this;return typeof t=="function"?t:e=>e[t]}},watch:{$attrs:{handler(t){const{_sortable:e}=this;e&&D(t).forEach(([n,o])=>{e.option(n,o)})},deep:!0}},methods:{getUnderlyingVm(t){return this.componentStructure.getUnderlyingVm(t)||null},getUnderlyingPotencialDraggableComponent(t){return t.__draggable_component__},emitChanges(t){b(()=>this.$emit("change",t))},alterList(t){if(this.list){t(this.list);return}const e=[...this.modelValue];t(e),this.$emit("update:modelValue",e)},spliceList(){const t=e=>e.splice(...arguments);this.alterList(t)},updatePosition(t,e){const n=o=>o.splice(e,0,o.splice(t,1)[0]);this.alterList(n)},getRelatedContextFromMoveEvent({to:t,related:e}){const n=this.getUnderlyingPotencialDraggableComponent(t);if(!n)return{component:n};const o=n.realList,r={list:o,component:n};return t!==e&&o?{...n.getUnderlyingVm(e)||{},...r}:r},getVmIndexFromDomIndex(t){return this.componentStructure.getVmIndexFromDomIndex(t,this.targetDomElement)},onDragStart(t){this.context=this.getUnderlyingVm(t.item),t.item._underlying_vm_=this.clone(this.context.element),m=t.item},onDragAdd(t){const e=t.item._underlying_vm_;if(e===void 0)return;u(t.item);const n=this.getVmIndexFromDomIndex(t.newIndex);this.spliceList(n,0,e);const o={element:e,newIndex:n};this.emitChanges({added:o})},onDragRemove(t){if(p(this.$el,t.item,t.oldIndex),t.pullMode==="clone"){u(t.clone);return}const{index:e,element:n}=this.context;this.spliceList(e,1);const o={element:n,oldIndex:e};this.emitChanges({removed:o})},onDragUpdate(t){u(t.item),p(t.from,t.item,t.oldIndex);const e=this.context.index,n=this.getVmIndexFromDomIndex(t.newIndex);this.updatePosition(e,n);const o={element:this.context.element,oldIndex:e,newIndex:n};this.emitChanges({moved:o})},computeFutureIndex(t,e){if(!t.element)return 0;const n=[...e.to.children].filter(s=>s.style.display!=="none"),o=n.indexOf(e.related),r=t.component.getVmIndexFromDomIndex(o);return n.indexOf(m)!==-1||!e.willInsertAfter?r:r+1},onDragMove(t,e){const{move:n,realList:o}=this;if(!n||!o)return!0;const r=this.getRelatedContextFromMoveEvent(t),i=this.computeFutureIndex(r,t),s={...this.context,futureIndex:i},a={...t,relatedContext:r,draggedContext:s};return n(a,e)},onDragEnd(){m=null}}});export{tt as default};
